#!/bin/bash

# Copyright Jonathan Riddell and Harald Sitter 2015, may be copied under GNU GPL v2 or later
# download ubuntu touch, upload it to the arm server, download remastered image from arm server

set -ex

SERVER=root@212.47.241.146
OUTPUTIMG=vivid-preinstalled-touch-armhf.tar.gz

echo "=== Running remote server harness  `date`"
scp remote-remaster $SERVER:/root
ssh $SERVER bash /root/remote-remaster

echo "=== downloading tar  `date`"
DATE=`date +%Y%m%d.%H%M%S`
IMGDIR=remaster-proposed/daily-preinstalled/${DATE}
mkdir -p $IMGDIR
scp $SERVER:/root/output/$OUTPUTIMG $IMGDIR

echo "=== running shasum  `date`"
cd $IMGDIR
sha256sum $OUTPUTIMG > SHA256SUMS
